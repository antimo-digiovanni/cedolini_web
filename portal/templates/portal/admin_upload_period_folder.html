{% extends "portal/base.html" %}
{% block title %}Importa Cedolini (Mese){% endblock %}

{% block content %}
<div class="card card-custom p-4">
  <h3 class="mb-1">Importa Cedolini (Mese)</h3>
  <div class="text-muted mb-3">
    Puoi caricare:
    <ul class="mb-0">
      <li><strong>tanti PDF insieme</strong> (selezione multipla)</li>
      <li>oppure una <strong>cartella</strong> (se il browser passa i percorsi)</li>
    </ul>
    Se i percorsi non arrivano, il sistema user√† <strong>mese/anno selezionati qui sotto</strong> + nome file/cartella dipendente.
  </div>

  {% if messages %}
    {% for m in messages %}
      <div class="alert alert-{{ m.tags }} mb-2">{{ m }}</div>
    {% endfor %}
  {% endif %}

  <form method="post" enctype="multipart/form-data" class="mt-3">
    {% csrf_token %}

    <div class="row g-3">
      <div class="col-md-4">
        <label class="form-label">Mese</label>
        <select name="month" class="form-select" required>
          <option value="">-- scegli mese --</option>
          <option value="1">Gennaio</option><option value="2">Febbraio</option><option value="3">Marzo</option>
          <option value="4">Aprile</option><option value="5">Maggio</option><option value="6">Giugno</option>
          <option value="7">Luglio</option><option value="8">Agosto</option><option value="9">Settembre</option>
          <option value="10">Ottobre</option><option value="11">Novembre</option><option value="12">Dicembre</option>
        </select>
      </div>

      <div class="col-md-4">
        <label class="form-label">Anno</label>
        <input type="number" name="year" class="form-control" min="2000" max="2100" required>
      </div>

      <div class="col-12">
        <label class="form-label">File PDF (multi-selezione) o cartella</label>
        <input type="file"
               name="files"
               class="form-control"
               multiple
               webkitdirectory
               directory>
        <div class="form-text">
          Seleziona tutti i PDF oppure seleziona direttamente la cartella del mese.
        </div>
      </div>
    </div>

    <button class="btn btn-primary mt-3" type="submit">
      <i class="bi bi-cloud-upload"></i> Importa
    </button>
  </form>
</div>

<div class="card card-custom p-4 mt-4">
  <h5 class="mb-3">Report</h5>
  <ul class="mb-0">
    <li><strong>Creati:</strong> {{ report.created }}</li>
    <li><strong>Aggiornati:</strong> {{ report.updated }}</li>
    <li><strong>Saltati:</strong> {{ report.skipped }}</li>
    <li><strong>Errori percorso:</strong> {{ report.path_error|length }}</li>
    <li><strong>Dipendenti non trovati:</strong> {{ report.employee_not_found|length }}</li>
  </ul>

  {% if report.employee_not_found %}
    <hr>
    <div><strong>Dipendenti non trovati:</strong></div>
    <ul>
      {% for x in report.employee_not_found %}
        <li>{{ x }}</li>
      {% endfor %}
    </ul>
  {% endif %}
</div>
{% endblock %}